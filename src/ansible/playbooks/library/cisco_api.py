#!/usr/bin/env python
from ansible.module_utils.basic import *
import sys
sys.path.append('/home/jgonzalez/dev/bot-cisco-vulnerability/src/ansible/playbooks/library')
from ciscoApi import CiscoVulnApi

openVulApi = CiscoVulnApi()

def main():
    module = AnsibleModule(
        argument_spec=dict(
            os=dict(required=False, default='ios'),
            version=dict(required=False, default='15.1(4)M12a'),
            check_string=dict(required=False, default='#')
        ),
        supports_check_mode=False)

    # if module.params['check_string'] not in output:
    #     module.fail_json(msg="Error: check_string not found", output=output)

    try:
        result = openVulApi.os(module.params['os'], module.params['version'])
    except Exception as e:
        module.fail_json(msg="Error: Uncategorized (Command)", output=e)

    # Success
    try:
        module.exit_json(msg="information collected successfully", output=result)
    except Exception as e:
        module.fail_json(msg="Error: Uncategorized (Exit)", output=e)

if __name__ == "__main__":
    main()